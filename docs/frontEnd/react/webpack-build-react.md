## å¼•è¨€

æœ€è¿‘å¼€å§‹åšè‡ªå·±çš„åšå®¢ç«™ï¼Œå› ä¸ºæ˜¯è‡ªå·±çš„é¡¹ç›®ä¸èµ¶è¿›åº¦ä¸èµ¶æ—¶é—´ï¼Œä¹Ÿä¸éœ€è¦åšçš„å¤šèŠ±å“¨ï¼Œæ‰€ä»¥å°±ä¸æ‰“ç®—ç”¨ç½‘ä¸Šé‚£äº›ç°æˆçš„ä¼˜ç§€æ„å»ºå·¥å…·æ¥å¯é¡¹ç›®ï¼Œè€Œæ˜¯è‡ªå·±ä»webpack+reactå¼€å§‹æ¥æ­å»ºä¸€ä¸ªç®€é™‹çš„ä¼ªå·¥ç¨‹åŒ–å‰ç«¯é¡¹ç›®ï¼Œé¡ºä¾¿ä¹Ÿå¤šäº†è§£ä¸€ç‚¹webpackï¼Œç„¶åå†å®é™…å¼€å‘ä¸­åœ¨ä¸€ç‚¹ä¸€ç‚¹æ‘¸ç´¢å’Œå®Œå–„é¡¹ç›®

![åˆ«è·‘](http://www.phplaozhang.com/uploads/layedit/20170622/960a6050ece1854caf016b6b04856d32.jpg)

## webpack

èŠèµ·webpackï¼Œå°±ä¸å¾—ä¸è¯´èµ·å‰ç«¯çš„å·¥ç¨‹åŒ–ã€‚éšç€JavaScriptçš„ä¸æ–­åšå¤§åšå¼ºï¼Œå‰ç«¯åšçš„ä¸ä»…ä»…æ˜¯ä¸€äº›é¡µé¢å±•ç¤ºå’Œé¡µé¢ç‰¹æ•ˆï¼Œè€Œæ˜¯æœ‰äº†è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·äº¤äº’å’Œç”¨æˆ·ä½“éªŒæ–¹é¢çš„ä¼˜åŒ–ï¼Œå¹¶ä¸”ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¹Ÿèƒ½ä»åç«¯è§£æ”¾å‡ºæ¥è½¬è€Œå€¾å‘å‰ç«¯ã€‚å‰ç«¯å·¥ç¨‹å¸ˆä»¬è¦é¢å¯¹çš„ä¸å†æ˜¯ç®€ç®€å•å•çš„ç½‘ç«™ï¼Œè€Œæ˜¯æ›´ä¸ºå¤æ‚çš„ web åº”ç”¨ï¼Œè¿™æ„å‘³ç€å‰ç«¯é¡¹ç›®æ„å»ºå¿…é¡»è¦å¾€æ›´åŠ ç³»ç»ŸåŒ–çš„å·¥ç¨‹çš„æ–¹å‘å»æ„å»ºã€‚

æƒ³èµ·å¼€å§‹å­¦å‰ç«¯çš„æ—¶å€™ï¼Œå°±ç®€å•çš„ä¸€ä¸ªé¡µé¢ä¸€ä¸ªæ–‡ä»¶æå®š+html/css/jså…¨éƒ¨å†™åœ¨ä¸€èµ·ï¼Œæ¯«æ— ç–‘é—®è¿™æ ·å¼€å‘æ•ˆç‡å¾ˆä½è€Œä¸”ä¼šåšå¾ˆå¤šå¤šä½™ä¸”é‡å¤çš„å·¥ä½œï¼Œæ‰€ä»¥å°±éœ€è¦æŠŠæŠŠå‰ç«¯é¡¹ç›®å½“æˆä¸€é¡¹ç³»ç»Ÿå·¥ç¨‹è¿›è¡Œåˆ†æã€ç»„ç»‡ã€æ„å»ºï¼Œåœ¨å¼€å‘å±‚é¢åšçš„æ›´åŠ çš„ç»„ä»¶åŒ–ã€æ¨¡å—åŒ–ã€è§„èŒƒåŒ–ç­‰ï¼Œä½¿å¾—é¡¹ç›®ç»“æ„æ¸…æ™°ã€å‡å°‘å†—ä½™å·¥ä½œé‡å’Œæé«˜å·¥ä½œæ•ˆç‡ã€‚

> å®é™…ä¸Šå‰ç«¯å·¥ç¨‹åŒ–è¿˜æ¶‰åŠåˆ°æ„å»º/éƒ¨ç½²/æµ‹è¯•/è‡ªåŠ¨åŒ–/æ€§èƒ½/ç¨³å®šæ€§/å¯ç”¨æ€§/å¯ç»´æŠ¤æ€§ï¼Œè¿˜åŒ…æ‹¬é‡Œé¢çš„ä¸€äº›éƒ¨ç½²/å‘å¸ƒ/CI/CD/ç°åº¦ç­‰æ¦‚å¿µå¯ä¸æ˜¯ä¸€ä¸¤å¥è¯å°±èƒ½è¯´æ¸…çš„

åŸºäºä¸Šè¿°èƒŒæ™¯ï¼Œå‰ç«¯è¯ç”Ÿäº†ä¸€ç³»åˆ—çš„è­¬å¦‚Grunt / Gulp / Webpack / Rollupç­‰ç­‰ç­‰ç­‰ä¼˜ç§€çš„å‰ç«¯æ„å»ºæ‰“åŒ…æ¨¡å—åŒ–å·¥å…·ï¼Œæ¯ç§å·¥å…·å„æœ‰é€‚ç”¨åœºæ™¯å’Œä¸å¦‚å…¶ä»–å·¥å…·æ“…é•¿çš„åŠŸèƒ½ï¼Œè¿™è¾¹èƒ½å°±ä¸å†å±•å¼€æè¿°äº†ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦è®²è¿°ç»“åˆwebpackæ„å»ºå‰ç«¯é¡¹ç›®çš„æ€è·¯ä»¥åŠä¸€äº›å¸¸è§çš„ä¼˜åŒ–ç‚¹

**æ‘˜ä¸€ä¸‹webpackçš„æ¦‚å¿µ**

> æœ¬è´¨ä¸Šï¼Œ*webpack* æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„*é™æ€æ¨¡å—æ‰“åŒ…å™¨(module bundler)*ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ª*ä¾èµ–å…³ç³»å›¾(dependency graph)*ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª *bundle*ã€‚

**å†å·ä¸€ä¸‹webpackçš„å›¾**

![image-20200511230228015](/Users/wuqingfu/Library/Application Support/typora-user-images/image-20200511230228015.png)

ä¸Šé¢çš„æ¦‚å¿µå’Œå›¾è¶³ä»¥ä¼ è¾¾webpackçš„æ€æƒ³å’Œä½œç”¨äº†ï¼Œæ€»ç»“æ¥è¯´å°±ä¸€å¥è¯ï¼šå‰ç«¯å·¥ç¨‹ä¸­ï¼Œå’±åªç®¡å¼€å‘å°±æˆäº†ï¼Œæ„å»ºç¥é©¬çš„å…¨ä¸€è‚¡è„‘å„¿äº¤ç»™webpackã€‚

ç½‘ä¸Šç‰¹åˆ«å¤šå…³äºä»0å¼€å§‹æ‰‹æŠŠæ‰‹æ•™æ“ä½œæ­å»ºé¡¹ç›®çš„ä¼˜ç§€æ–‡ç« ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯å€Ÿé‰´äº†å¤§ä½¬æ–‡ç« æ¥å­¦ä¹ ä½¿ç”¨webpack===>[webpack æ­å»ºç®€å• React é¡¹ç›®](https://juejin.im/post/5eb79fbb5188256b246a1308)ï¼Œæ‰€ä»¥è¿™è¾¹ä¹Ÿç›´æ¥æ è¿‡æœ¬äººç²—æµ…çš„webpackç†è§£ç¯‡å¹…ï¼Œç›´æ¥è¿›å…¥æ„å»ºè¿‡ç¨‹

## æ„å»ºé¡¹ç›®

ä¿—è¯è¯´ï¼Œæ²¡æœ‰è§„çŸ©ä¸æˆæ–¹åœ†ï¼Œæ¯åšä¸€ä¸ªé¡¹ç›®ä¹‹å‰ï¼Œéƒ½éœ€è¦å…ˆæƒ³å¥½è¿™ä¸ªå·¥ç¨‹çš„åˆè¡·ã€é¢„æœŸä»¥åŠå¯èƒ½å‡ºç°çš„ä¸å¯æŠ—åŠ›å› ç´ ï¼ˆæ¯”å¦‚è¯´é‚£å¤©çªç„¶ä¸æƒ³ç»§ç»­å†™äº†...ï¼‰ã€‚æ‰€ä»¥åœ¨åˆå§‹åŒ–é¡¹ç›®ä¹‹å‰ï¼Œéœ€è¦å¯¹è¿™ä¸ªé¡¹ç›®åšä¸€ä¸ªç®€å•çš„è§„åˆ’ï¼Œä»¥ä¾¿äºåç»­çš„å¼€å‘è¿­ä»£å’Œç»´æŠ¤

**é¡¹ç›®ç»“æ„**

```bash
â”œâ”€â”€ dist                        ç¼–è¯‘åé¡¹ç›®æ–‡ä»¶
â”œâ”€â”€ node_modules                ä¾èµ–åŒ…
â”œâ”€â”€ public                      é™æ€èµ„æºæ–‡ä»¶
â”œâ”€â”€ script                      æ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ analyzer.js               åˆ†æåŒ…å¤§å°    
â”‚   â”œâ”€â”€ build.js                  æ‰“åŒ…    
â”‚   â”œâ”€â”€ dll.js                    æŠ½ç¦»å…¬å…±çš„ä¾èµ–    
â”‚   â”œâ”€â”€ start.js                  å¼€å‘ç¯å¢ƒå¯åŠ¨    
â”‚   â”œâ”€â”€ webpack.base.config.js    webpackåŸºç¡€é…ç½®    
â”œâ”€â”€ src                         æºç 
â”‚   â”œâ”€â”€ pages                     é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ ...												å…¶å®ƒ
â”‚   â”œâ”€â”€ index.tsx                 å…¥å£æ–‡ä»¶
â”œâ”€â”€ .babelrc                    babel é…ç½®
â”œâ”€â”€ .eslintrc.js                eslint é…ç½®
â”œâ”€â”€ .gitignore                  å¿½ç•¥æäº¤åˆ°gitç›®å½•æ–‡ä»¶
â”œâ”€â”€ .prettierrc                 ä»£ç ç¾åŒ–
â”œâ”€â”€ package.json                ä¾èµ–åŒ…åŠé…ç½®ä¿¡æ¯æ–‡ä»¶
â”œâ”€â”€ tsconfig.json               typescript é…ç½®
â”œâ”€â”€ README.md                   æè¿°æ–‡ä»¶
```

å› ä¸ºæœ¬ç¯‡è®²çš„ä¾§é‡ç‚¹æ˜¯ç†è®ºï¼Œæ‰€ä»¥å¯¹æºç è®²çš„æ¯”è¾ƒå°‘ã€‚æ‰€ä»¥è¿™è¾¹ç®€å•æè¿°ä¸€ä¸‹scriptä¸‹çš„å„ä¸ªæ–‡ä»¶ï¼š

* webpack.base.config.js

  è¿™æ˜¯ä¸€ä¸ªåŸºç¡€çš„webpackæ–‡ä»¶ï¼Œé…ç½®äº†åŒ…æ‹¬å…¥å£ã€è¾“å‡ºã€è§£ææ¨¡å—ã€ä»£ç å‹ç¼©å»é‡ã€æ‹†åŒ…æå–ã€htmlæ¨¡ç‰ˆç­‰åŸºæœ¬é…ç½®ã€‚ä¸ºä»€ä¹ˆä¼šéœ€è¦æŠ½å‡ºæ¥ï¼Œä¸»è¦å‡ºäºä¸¤ç‚¹æ¥è€ƒé‡

  1. æŠ½ç¦»å…¬å…±ä»£ç ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´æ˜äº†
  2. ä¿è¯å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒå°½é‡ä¸€è‡´ï¼Œé¿å…ä¸€äº›å› ä¸ºç¯å¢ƒå·®å¼‚å¸¦æ¥çš„æ— æ„ä¹‰é—®é¢˜

* start.js

  é¡¹ç›®å¼€å‘ç¯å¢ƒå¯åŠ¨çš„å…¥å£ï¼Œè¿™è¾¹èšåˆäº†åŸºç¡€é…ç½®å’Œå¼€å‘æ—¶çš„é…ç½®ï¼Œè­¬å¦‚devServer/HMRç­‰å¼€å‘ç¯å¢ƒé…ç½®é¡¹

  ```js
  plugins: [
    new webpack.HotModuleReplacementPlugin(),
    new webpack.NoEmitOnErrorsPlugin()
  ]
  ```

* build

  é¡¹ç›®æ‰“åŒ…æ„å»ºå…¥å£ï¼Œé™¤äº†åŸºæœ¬é…ç½®ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›æ„å»ºæ€§èƒ½ç›‘æ§ä»£ç ç­‰ã€‚è­¬å¦‚ä½¿ç”¨HappyPackæ¥åŠ å¿«æ‰“åŒ…é€Ÿåº¦ï¼š

  ```js
  new HappyPack({
    threads,
    id: 'jsx',
    loaders: ['babel-loader']
  }),
  ```

* dll.js

  æŠ½ç¦»ç¬¬ä¸‰æ–¹æ¨¡å—,å‡å°‘æ„å»ºä½“ç§¯

* analyzer.js

  æ‰“åŒ…æ„å»ºå®Œæˆä¹‹åï¼Œéœ€è¦å¯¹åŒ…çš„æ‹†åˆ†å¤§å°ç­‰åšä¸ªè¯¦ç»†çš„åˆ†æï¼Œæœ‰åˆ©äºå¯¹æ‹†åŒ…å’Œä»£ç ç»“æ„è°ƒæ•´åšè¿›ä¸€æ­¥çš„ä¼˜åŒ–

### ä¸€ã€æŠ€æœ¯æ ˆ

å‰ç«¯æŠ€æœ¯é€‰å‹åŸºæœ¬ç»•ä¸å¼€ä¸‰å¤§æ¡†æ¶react/vue/angularï¼Œæ¯ä¸ªæ¡†æ¶éƒ½æœ‰é€‚ç”¨å’Œä¸é€‚ç”¨çš„åœºæ™¯ï¼Œè¿˜æœ‰æ¡†æ¶å¸¦æ¥çš„ç”Ÿæ€ç³»ç»Ÿã€å­¦ä¹ æˆæœ¬ã€ç¨³å®šæ€§å’Œé…åˆåŸºç¡€æ„å»ºçš„èƒ½åŠ›ç­‰ç­‰ç­‰ç­‰ä¸€ç³»åˆ—ç­‰è€ƒé‡ã€‚

å› ä¸ºæ˜¯ä¸ªäººé¡¹ç›®æ‰€ä»¥å°±ç›´æ¥è€ƒè™‘ç”¨typescript+reactå…¨å®¶æ¡¶å¼€å‘äº†,é…ç½®ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•

```js
// babelç¼–è¯‘ .babelrcé…ç½®
{
  test: /.jsx?$/,
  exclude: /(node_modules|bower_components)/,
  loader: 'babel-loader'
},
// ä½¿ç”¨typescript
{
  test: /\.(ts|tsx)$/,
  exclude: /node_modules/,
  use: {
  	loader: 'ts-loader',
  },
}
 
// .babelrc
{
  "presets": [
    "@babel/react",
    "@babel/preset-env"
  ],
  "plugins": [
    "@babel/transform-runtime"
  ]
}
```

### äºŒã€å…¼å®¹æ€§

å‰ç«¯é¡¹ç›®ç»•ä¸å¼€çš„ä¸€ä¸ªç‚¹å°±æ˜¯å…¼å®¹æ€§çš„é—®é¢˜äº†ï¼Œå‰ç«¯å…¼å®¹æ€§é—®é¢˜ä¸»è¦æœ‰ä¸¤ä¸ªç­–ç•¥

* æ¸è¿›å¢å¼º

  æ¸è¿›å¢å¼ºä¿è¯ä½ç‰ˆæœ¬æµè§ˆå™¨çš„ä½“éªŒï¼Œå¯¹äºæ”¯æŒæ–°ç‰¹æ€§çš„æ–°æµè§ˆå™¨æä¾›ç¨å¥½çš„ä½“éªŒ

* ä¼˜é›…é™çº§

  ä¼˜é›…é™çº§åˆ™æ˜¯ç›¸åçš„ï¼Œä¸ºç°ä»£æµè§ˆå™¨æä¾›æœ€å¥½çš„ä½“éªŒï¼Œè€Œæ—§æµè§ˆå™¨åˆ™é€€è€Œæ±‚ä¹‹æ¬¡ï¼Œä¿è¯å¤§æ¦‚çš„åŠŸèƒ½

è¿™è¾¹é€‰ç”¨çš„æ˜¯ä¼˜é›…é™çº§çš„ç­–ç•¥ï¼ˆå› ä¸ºå®é™…ä¸Šå°±æ²¡æƒ³è¿‡ä½ç‰ˆæœ¬æµè§ˆå™¨çš„å…¼å®¹=.=ï¼‰

### ä¸‰ã€ ç¼–ç è§„èŒƒ

é¡¹ç›®çš„ç¼–ç è§„èŒƒä¹Ÿæ˜¯è€ç”Ÿå¸¸è°ˆçš„è¯é¢˜äº†ï¼Œè‰¯å¥½çš„ç¼–ç ä¹ æƒ¯åˆ©äºé•¿æœŸç»´æŠ¤é¡¹ç›®ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ï¼Œå‡å°‘é—ç•™ç³»ç»Ÿç»´æŠ¤çš„è´Ÿæ‹…ï¼Œå¯ä»¥å°‘èƒŒå› ä¸ºåƒåœ¾ä»£ç è€Œå¸¦æ¥çš„æŠ€æœ¯å€ºã€‚

ç½‘ä¸Šå¸¸ç”¨ä¸”æ¨èä½¿ç”¨çš„éƒ½æ˜¯eslintæ¥çº¦æŸä»£ç è§„èŒƒï¼Œå†ç”¨Prettieræ¥ç¾åŒ–ï¼Œæœ€åç”¨huskyæ¥é™åˆ¶æäº¤

ä¸è¿‡å› ä¸ºæœ¬äººå¯¹è‡ªå·±çš„ç¼–ç é£æ ¼æœ‰è¶³å¤Ÿçš„è‡ªä¿¡ï¼Œæ‰€ä»¥è¿™æ¬¡é¡¹ç›®å°±ä¸€ä¸ªéƒ½æ²¡ç”¨

![è†¨èƒ€çš„å¾ˆ](http://biaoqingbao.xin/wp-content/uploads/2017/10/1685.jpg)

### å››ã€å‰ç«¯ç›‘æ§å’Œä¼˜åŒ–

ä¸€ä¸ªæˆç†Ÿçš„ç½‘ç«™ï¼Œå¿…ç„¶æœ‰é…å¥—æœ‰æˆç†Ÿçš„ç›‘æ§ç³»ç»Ÿæ¥æ”¯æ’‘ã€‚è€Œå¥½çš„ç›‘æ§ç³»ç»Ÿä¸ä»…èƒ½å¸®æˆ‘åšåˆ°ç½‘ç«™çš„pv/uv/ç”¨æˆ·ä¹ æƒ¯/ç”¨æˆ·è¡Œä¸ºç­‰åˆ†æç»Ÿè®¡ï¼Œæ›´æœ‰åŠæ—¶å‘ç°ç³»/å¤„ç†ç»Ÿå¼‚å¸¸ï¼Œæ’æŸ¥é”™è¯¯ï¼Œé¿å…ä¸¥é‡çš„ç”Ÿäº§æ•…éšœçš„èƒ½åŠ›ã€‚

è™½ç„¶æ˜¯ä¸ªäººçš„å’¸é±¼ç«™ç‚¹ï¼Œä½†æ˜¯æ¢¦æƒ³è¿˜æ˜¯è¦æœ‰çš„ï¼Œè€ƒè™‘åˆ°æœ¬äººä»¥åå¯èƒ½ä¼šç«ï¼Œæ‰€ä»¥é˜²æ‚£äºæœªç„¶åˆ°ç½‘ä¸Šä¸€äº›ç›‘æ§ç»Ÿè®¡ç³»ç»Ÿã€‚æ‰¾äº†ä¸€åœˆè¦ä¹ˆå°±æ˜¯è¦èŠ±é’±ï¼ˆå£è¢‹ç©ºç©ºï¼Œæ²¡æœ‰é¢„ç®—ï¼‰ï¼Œè¦ä¹ˆå°±æ˜¯æ²¡æ‰¾åˆ°ç¬¦åˆé¢„æœŸæ•ˆæœçš„ï¼Œæ‰€ä»¥å°±è‡ªå·±å†™äº†å‡ ä¸ªåŸ‹ç‚¹æ¥å£ï¼ˆ[å‚ç…§ä¸ŠæœŸæ–‡ç« ä¸­çš„æ¥å£å®ç°éƒ¨åˆ†](https://juejin.im/post/5eb3e1b4e51d45244e7c2d09)ï¼‰ï¼ŒèŠèƒœäºæ— å§ï¼Œä»…ç”¨äºç›‘æ§å¼‚å¸¸å’Œç»Ÿè®¡åˆ†æï¼Œæ–¹ä¾¿äºåç»­ç³»ç»Ÿçš„æŒç»­ä¼˜åŒ–

### å››ã€æœ¬é¡¹ç›®ä¸­ä¸é‡è¦çš„ä¸€äº›è§„èŒƒ

è¿˜æœ‰å¾ˆå¤šå¯¹äºå›¢é˜Ÿé¡¹ç›®æ¥è¯´å¾ˆé‡è¦çš„è§„èŒƒï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸ªé¡¹ç›®æ˜¯ä¸ªäººé¡¹ç›®ï¼Œæ‰€ä»¥è¿™è¾¹å°±ç®€å•æä¸€ä¸‹ï¼š

1. ä»£ç åˆ†æ”¯ç®¡ç†
2. æµç¨‹è§„èŒƒ
3. åä½œè§„èŒƒ
4. åˆç†æ˜ç¡®åˆ†å·¥
5. å‘å¸ƒæ„å»ºæµç¨‹
6. ä»£ç è´¨é‡è§„èŒƒ
7. ä»£ç é£æ ¼è§„èŒƒ
8. ä»£ç æç‚¼/å¤ç›˜
9. æµ‹è¯•è§„èŒƒ
10. æŒç»­ç»´æŠ¤è®¡åˆ’
11. æ–‡æ¡£è§„èŒƒ
13. ...

### äº”ã€ä¸€äº›ä¼˜åŒ–ç‚¹

#### åŠ¨æ€å¼•å…¥

å¯¹äºä¸€äº›å…¬å…±çš„æ¨¡å—ï¼Œè­¬å¦‚è·¯ç”±æˆ–è€…reduxç­‰ï¼Œå¯ä»¥é€šè¿‡webpackçš„require.contextæ¨¡å—æ¥åŠ¨æ€å¼•å…¥

1. åŠ¨æ€å¯¼å…¥è·¯ç”±

   ```js
   let RouteMap = []
   // ç™½åå•
   const WHITE_LIST = ['login']
   // NOTE: é»˜è®¤ä¸è€ƒè™‘è·¯ç”±ä¼ å‚çš„æƒ…å†µ[xxx/:id],è¿™ç§åœºæ™¯è¿˜æ²¡æƒ³å¥½ç”¨ä»€ä¹ˆæ–¹å¼æ¥è§£å†³
   // åŠ¨æ€è¯»å–pagesä¸‹çš„æ‰€æœ‰ç›®å½•ï¼ŒæŠŠæ¯ä¸ªç›®å½•éƒ½å½“æˆä¸€ä¸ªè·¯ç”±
   const files = require.context('./pages', true, /\/index\.jsx$/)
   files.keys().forEach(key => {
     // const pattern = /(?<=\/).+(?=\/)/
     const pattern = /\.\/(.+)\/(\w+)\.jsx?$/
     const route = key.match(pattern)[1]
     // ç™½åå•è·¯ç”±è·³è¿‡
     if (!WHITE_LIST.includes(route)) {
       RouteMap.push({
         path: route,
         component: files(key).default
       })
     }
   })
   
   const LayoutRoute = (props) => (
     <Layout {...props}>
       <Switch>
         { RouteMap.map(({path, component}) => <Route key={path} exact path={`/app/${path}`} component={component} />) }
       </Switch>
     </Layout>
   )
   ```

   è¿™æ ·ï¼Œå°±ä¸éœ€è¦æ¯æ¬¡éƒ½è¦å¼•å…¥ä¸€ä¸ªè·¯ç”±æ–‡ä»¶ï¼ŒæŠŠè·¯ç”±æ–‡ä»¶æ˜ å°„åˆ°å¯¹åº”çš„è·¯ç”±ä¸Šäº†ï¼Œåªè¦è§„åˆ™å®šçš„å¤šï¼Œå®šçš„å¥½ï¼Œç”šè‡³è¿é…ç½®è·¯ç”±æ–‡ä»¶é‚£ä¸€æ­¥éƒ½å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°ã€‚

2. åŠ¨æ€æ³¨å†Œreduxæ¨¡å—

   ```js
   // è‡ªåŠ¨æ³¨å†Œreduceræ¨¡å—
   let rootReducer = {}
   const reducersFiles = require.context('./reducers', false, /\.js$/)
   reducersFiles.keys().map(filename => {
     // const pattern = /(?<=\.\/).+(?=\.js)/ æ–°è¯­æ³•ï¼Œéƒ¨åˆ†æµè§ˆå™¨è¿˜ä¸æ”¯æŒ
     const pattern = /\/(\w+)\.jsx?$/
     try {
       const matchRes = filename.match(pattern)
       const key = matchRes[1]
       rootReducer[key] = reducersFiles(filename).default
     } catch (e) {
       console.log('æ— æ³•æ³¨å†Œ', e)
     }
   })
   
   // è‡ªåŠ¨æ³¨å†Œsagaæ¨¡å—
   let rootSagaList = []
   const sagaFiles = require.context('./sagas', false, /\.js/)
   sagaFiles.keys().map(filename => {
     rootSagaList.push(fork(sagaFiles(filename).default))
   })
   ```

é€šè¿‡require.contextï¼Œå°±èƒ½å¤Ÿçœæ‰å¾ˆå¤šæ— ç”¨ä¸”é‡å¤çš„ä»£ç ï¼Œè‡³å°‘ä¸éœ€è¦å†ä¸€ä¸ªä¸ªæ¨¡å—æ–‡ä»¶çš„å¯¼å…¥äº†ï¼Œåç»­å¯ä»¥å­¦ä¸€ä¸‹dvaæ€è·¯ï¼Œå†è¿›è¡Œä¸€å±‚åŒ…è£…ï¼Œå½“ç„¶è¿™æ˜¯åè¯äº†ã€‚

#### babel ä¼˜åŒ–

å› ä¸ºæµè§ˆå™¨ä¹‹é—´çš„å…¼å®¹æ€§é—®é¢˜è¿˜æœ‰æµè§ˆå™¨å®ç°w3cè§„èŒƒçš„æ—¶é—´å·®å¼‚ï¼Œä¸ºäº†é¿å…æˆ‘ä»¬ç”¨çš„apiåœ¨æµè§ˆå™¨ä¸Šè¿˜æ²¡å®ç°ï¼Œæ‰€ä»¥ä¸€èˆ¬å‰ç«¯é¡¹ç›®éƒ½ä¼šå¼•å…¥babelåšä¸€ä¸ªç¼–è¯‘ã€‚å¼•å…¥è¿™è¾¹ç¼–è¯‘å·¥å…·ï¼Œä¹Ÿéœ€è¦èƒ½å¤Ÿå¯¹é¡¹ç›®ç»“æ„è¿›è¡Œä¸€äº›ç®€å•çš„ä¼˜åŒ–

1. æ’é™¤ node_modules/bower_components ç¼–è¯‘ï¼Œ exclude: /(node_modules|bower_components)/

   ```js
   // webpack.base.config.js
   {
     test: /.jsx?$/,
     exclude: /(node_modules|bower_components)/,
     loader: 'babel-loader'
   }
   ```

2. ä½¿ç”¨@babel/transform-runtimeæŠ½å‡ºå…¬å…±æ¨¡å—ï¼Œå‡å°ä»£ç ä½“ç§¯

   ```js
   // .babelrc
   "plugins": [
     "@babel/transform-runtime"
   ]
   ```
   
3. ä½¿ç”¨happypackï¼Œå¼€å¯å¤šä¸ªçº¿ç¨‹

   å› ä¸ºwebpackå•¥å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥æœ‰æ—¶å€™æˆ‘ä»¬å¹¶ä¸èƒ½å……åˆ†åˆ©ç”¨åˆ°ç°ä»£cpuå¤šæ ¸çš„ä¼˜åŠ¿ï¼Œæ‰€ä»¥éœ€è¦æƒ³åŠæ³•åˆ©ç”¨è¿™ä¸ªä¼˜åŠ¿æ¥æé«˜æ‰“åŒ…ç¼–è¯‘æ•ˆç‡ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨åˆ°HappyPackæ¥åšè¿™æ ·çš„äº‹æƒ…äº†ï¼Œè®©ä»»åŠ¡åˆ†è§£ç»™å¤šä¸ªå­è¿›ç¨‹åšå¹¶å‘æ‰§è¡Œ

   ```js
   const HappyPack = require('happypack')
   // æ‰‹åŠ¨åˆ›å»ºè¿›ç¨‹æ± 
   const happyThreadPool =  HappyPack.ThreadPool({ size: os.cpus().length })
   
   module.exports = {
     module: {
       rules: [
         ...
         {
           test: /\.ts$/,
           // é—®å·åé¢çš„æŸ¥è¯¢å‚æ•°æŒ‡å®šäº†å¤„ç†è¿™ç±»æ–‡ä»¶çš„HappyPackå®ä¾‹çš„åå­—
           loader: 'happypack/loader?id=happyBabel',
           ...
         },
       ],
     },
     plugins: [
       ...
       new HappyPack({
         // è¿™ä¸ªHappyPackçš„â€œåå­—â€å°±å«åšhappyBabelï¼Œå’Œæ¥¼ä¸Šçš„æŸ¥è¯¢å‚æ•°é¥ç›¸å‘¼åº”
         id: 'happyBabel',
         // æŒ‡å®šè¿›ç¨‹æ± 
         threadPool: happyThreadPool,
         loaders: ['babel-loader?cacheDirectory']
       })
     ],
   }
   ```

#### æ‰“åŒ…æ€§èƒ½ç›‘æ§

å¦‚æœæˆ‘ä»¬æ‰“åŒ…ä½“ç§¯è¿‡å¤§ï¼Œé‚£ä¹ˆä½“ç°åœ¨ä½¿ç”¨ä¸Šå°±ä¼šå¯¼è‡´é¡µé¢åŠ è½½æ—¶é—´ç‰¹åˆ«é•¿ï¼Œè¿™æ ·æ˜¯éå¸¸éå¸¸ä¸å¥½çš„ä¸€ä¸ªä½“éªŒï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€ä¸ªæç¤ºæœºåˆ¶ï¼Œå½“æˆ‘ä»¬æ‰“åŒ…æ–‡ä»¶è¿‡å¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬èƒ½å¤ŸåŠæ—¶çŸ¥é“æ–‡ä»¶å¤§å°ï¼Œwebpack*ä¹Ÿæä¾›äº†éå¸¸æ–¹ä¾¿çš„åŠŸèƒ½*<code>performance</code>

```js
performance: {
  hints: 'warning', // æç¤ºç±»å‹
    // å®šä¸€ä¸ªåˆ›å»ºåè¶…è¿‡ 200kb çš„èµ„æºï¼Œå°†å±•ç¤ºä¸€æ¡è­¦å‘Š
    maxAssetSize: 1024 * 200,
    maxEntrypointSize: 1024 * 200,
}
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½åŠæ—¶å‘ç°æ‰“åŒ…ä¸­å‡ºç°çš„å¤§ä½“ç§¯åŒ…ï¼Œç„¶åå¯¹æ‰“åŒ…å’Œå¼€å‘åšè¿›ä¸€æ­¥çš„ä¼˜åŒ–

#### æŠ½ç¦»ç¬¬ä¸‰æ–¹ä¾èµ–

webpackæä¾›äº†éå¸¸å¥½çš„ä¸€ä¸ªåŠŸèƒ½<code>DllPlugin</code>,å®ƒèƒ½å¤Ÿå¾ˆå¥½çš„æŠŠç¬¬ä¸‰æ–¹ä¾èµ–æŠ½ç¦»å‡ºæ¥ï¼Œç„¶åç”Ÿäº§ä¸€ä¸ªæ˜ å°„æ–‡ä»¶<code>manifest.json</code>

```js
const OUTPUT_PATH = BUILD_OUTPUT_DIR ? `${BUILD_OUTPUT_DIR}/lib/` : path.resolve('dist/lib')
// ...
module.exports = {
  // ...
	plugins: [
		// æŠ½ç¦»åŒ…çš„æ’ä»¶
    new webpack.DllPlugin({
			context: __dirname,
			path: path.resolve(OUTPUT_PATH, 'manifest.json'),
			name: '[name]-[hash]'
		})
	]
}
```

æŠŠåŒ…æŠ½ç¦»å‡ºæ¥åï¼Œå°±éœ€è¦é€šè¿‡è¿™ä¸ªæ˜ å°„æ–‡ä»¶å»ä½¿ç”¨è¿™äº›åŒ…ï¼Œè¿™æ—¶å€™å°±ä¼šç”¨åˆ°<code>DllReferencePlugin</code>æ˜ å°„åˆ°ç›¸å…³çš„ä¾èµ–ä¸Šå»çš„ï¼Œè¿™æ—¶å€™å¯åŠ¨é¡¹ç›®ï¼Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨è¿™äº›ä¾èµ–äº†

```js
new webpack.DllReferencePlugin({
  context: __dirname,
  sourceType: "commonjs2",
  name: 'lib_dll',
  manifest: dllMap // manifest.jsonåœ°å€
})
```

#### splitChunks

webpack4.xåæä¾›äº†æ›´åŠ æ–¹ä¾¿çš„æ‹†åŒ…åŠŸèƒ½<code>splitChunks</code>ï¼Œç®—æ˜¯ä¸€ä¸ªä¼˜åŒ–ç‰ˆçš„<code>DllPlugin</code>å§

*Tipsï¼šä¸çŸ¥é“æ˜¯ä¸æ˜¯é…ç½®é—®é¢˜ï¼Œæœ¬æ¥åœ¨åŒæ—¶ç”¨çš„æ—¶å€™ä¼šå¯¼è‡´ä¸€äº›åŒ…è¢«æ‰“åŒ…ä¸¤æ¬¡ï¼Œåè€Œå¢å¤§äº†ä½“ç§¯*

```js	
optimization: {	
		// æ‰“åŒ…åå†æ‹†åŒ…
    splitChunks: {
      // è¿™è¡¨ç¤ºå°†é€‰æ‹©å“ªäº›å—è¿›è¡Œä¼˜åŒ–ã€‚å½“æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæœ‰æ•ˆå€¼ä¸º all, async å’Œ initial. æä¾› all å¯ä»¥ç‰¹åˆ«å¼ºå¤§ï¼Œå› ä¸ºè¿™æ„å‘³ç€å³ä½¿åœ¨å¼‚æ­¥å’Œéå¼‚æ­¥å—ä¹‹é—´ä¹Ÿå¯ä»¥å…±äº«å—ã€‚
      chunks: 'all',
      // è¦ç”Ÿäº§çš„å—æœ€å°å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰
      minSize: 10240,
      maxSize: 0,
      // åˆ†å‰²å‰å¿…é¡»å…±äº«æ¨¡å—çš„æœ€å°å—æ•°
      minChunks: 1,
      // æŒ‰éœ€åŠ è½½æ—¶çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°
      maxAsyncRequests: 5,
      // å…¥å£ç‚¹å¤„çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°
      maxInitialRequests: 3,
      // æŒ‡å®šç”¨äºç”Ÿæˆçš„åç§°çš„åˆ†å‰²ç¬¦ vendors~main.js
      automaticNameDelimiter: '~',
      // æ‹†åˆ†å—çš„åç§°
      name: true,
      cacheGroups: {
        // æŠ½å‡ºcss
        // styles: {
        //   name: 'static/css/styles',
        //   test: /\.(css|scss|sass)$/,
        //   chunks: 'all',
        //   enforce: true,
        // },
        // æŠ½å‡ºå…¬å…±æ¨¡å—
        commons: {
          name: 'static/js/components',
          test: path.join(__dirname, '..', 'src/components'),
          minChunks: 3,
          priority: 5,
          reuseExistingChunk: true,
        },
        // å•ç‹¬æŠ½å‡ºreact
        react: {
          test: /[\\/]node_modules[\\/](react)[\\/]/,
          name: 'static/js/react',
          priority: 20,
        },
        // å•ç‹¬æŠ½å‡ºreact-dom
        reactDom: {
          test: /[\\/]node_modules[\\/](react-dom)[\\/]/,
          name: 'static/js/react-dom',
          priority: 20,
        },
        // æŠ½å‡ºç¬¬ä¸‰æ–¹çš„åŒ…
        vendors: {
          name: 'static/js/vendors',
          test: /[\\/]node_modules[\\/]/,
          priority: 15,
        },
        default: {
          minChunks: 2,
          priority: -20,
          reuseExistingChunk: true,
        },
      },
    },
 }
```

ä¸Šé¢çš„é…ç½®æŠŠä¸€ä¸ªå…¬ç”¨çš„ç»„ä»¶è¿˜æœ‰æ¯”è¾ƒå¤§çš„ä¾èµ–éƒ½æŠ½ç¦»å‡ºæ¥äº†ï¼Œwebpackä¼šæŠŠreact-dom/react/å…¶å®ƒç¬¬ä¸‰æ–¹ä¾èµ–éƒ½æŠ½ç¦»å‡ºæ¥ï¼Œåˆ†åˆ«ç”Ÿæˆä¸‰ä¸ªæ–‡ä»¶ï¼Œå½“ç„¶ï¼Œå¦‚æœæœ‰å…¶å®ƒæ¯”è¾ƒå¤§çš„ä¾èµ–çš„è¯ï¼Œä¹Ÿå¯ä»¥å†åŠ è§„åˆ™æŠ½ç¦»å‡ºæ¥

### å…­ã€åç»­çš„è®¡åˆ’

1. æŒç»­ä¼˜åŒ–webpacké…ç½®
2. å¼•å…¥eslint è§„èŒƒä»£ç 
3. å¼•å…¥jestå®ç°å•å…ƒæµ‹è¯•
4. æ„å»ºç¼“å­˜ç­–ç•¥ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
5. æ”¹é€ é¡¹ç›®ä¸ºssr/æœåŠ¡ç«¯æ¸²æŸ“
6. æŠ½ç¦»å…¬ç”¨ç»„ä»¶ï¼Œæ„å»ºç»„ä»¶åº“
7. ä¼˜åŒ–å‰ç«¯ç›‘æ§æ¨¡å—
8. ...

## ç»“æŸè¯­

çº¸ä¸Šå¾—æ¥æ€»è§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œï¼Œä»¥å‰çœ‹åˆ«äººéšéšä¾¿ä¾¿æ­å»ºä¸€ä¸ªé¡¹ç›®æ„Ÿè§‰æ²¡å•¥ï¼Œè½®åˆ°è‡ªå·±åšçš„æ—¶å€™å°±æ„Ÿè§‰ç§ƒé¡¶å‘å‡‰ï¼Œä»…ä»¥æ­¤ç¯‡ï¼Œç¥­å¥ é‚£äº›ç¦»æˆ‘è€Œå»çš„å¤´å‘å§ã€‚

![çŸ¥è¯†ç›²åŒº](https://pic1.zhimg.com/80/v2-df4636a21ecd987c10de850af7ef3370_1440w.jpg)

ğŸ‘ [github ä»“åº“åœ°å€](https://github.com/tguzi/drip-flow-web)
